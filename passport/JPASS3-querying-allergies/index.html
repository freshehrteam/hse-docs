
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../images/hse.jpg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.5">
    
    
      
        <title>Querying for patient allergies - openEHR CDR API for HL7v2 to openEHR integration (HSE)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#querying-for-patient-allergies" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="openEHR CDR API for HL7v2 to openEHR integration (HSE)" class="md-header__button md-logo" aria-label="openEHR CDR API for HL7v2 to openEHR integration (HSE)" data-md-component="logo">
      
  <img src="../../images/hse.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            openEHR CDR API for HL7v2 to openEHR integration (HSE)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Querying for patient allergies
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="openEHR CDR API for HL7v2 to openEHR integration (HSE)" class="md-nav__button md-logo" aria-label="openEHR CDR API for HL7v2 to openEHR integration (HSE)" data-md-component="logo">
      
  <img src="../../images/hse.jpg" alt="logo">

    </a>
    openEHR CDR API for HL7v2 to openEHR integration (HSE)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Introduction to openEHR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Introduction to openEHR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/INT1-overview-openehr/" class="md-nav__link">
        Overview of openEHR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/INT2-overview-rest-apis/" class="md-nav__link">
        Overview of openEHR REST APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/INT3-archetypes-template/" class="md-nav__link">
        openEHR archetypes and templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/INT4-reference-model/" class="md-nav__link">
        openEHR Reference Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../postman/PM1-postman-getting-ready/" class="md-nav__link">
        Getting ready with Postman
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../postman/PM2-navigate-postman/" class="md-nav__link">
        Navigate Postman
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../postman/PM3-using-postman/" class="md-nav__link">
        Using Postman with Ehrscape
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          HSE openEHR PoC project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          HSE openEHR PoC project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE1-hse-project-overview/" class="md-nav__link">
        Overview of the HSE openEHR PoC project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE2-retrieving-an-ehr/" class="md-nav__link">
        Retrieving the patient's ehrId
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE3-creating-an-ehr/" class="md-nav__link">
        Creating a new patient 'EHR'
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE4-discharge-summary-integration/" class="md-nav__link">
        Discharge Summary integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE5-committing-composition-data/" class="md-nav__link">
        Committing Composition data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE6-retrieving-composition-data/" class="md-nav__link">
        Retrieving a Patient Observations Composition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE7-querying-diagnoses/" class="md-nav__link">
        Querying for diagnoses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE8-composition-constraints/" class="md-nav__link">
        Understanding composition Constraints and validation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE9-openehr-datatypes/" class="md-nav__link">
        openEHR Datatypes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hse/HSE10-openehr-rm-attributes/" class="md-nav__link">
        Key openEHR RM attributes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          openCDR API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          openCDR API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../opencdr/OCDR1-authentication/" class="md-nav__link">
        Getting started - Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../opencdr/OCDR2-openehr-templates/" class="md-nav__link">
        Working with openEHR Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../opencdr/OCDR3-committing-a-composition/" class="md-nav__link">
        Committing Observation data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../opencdr/OCDR4-retrieving-a-composition/" class="md-nav__link">
        Retrieving an openEHR Composition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../opencdr/OCDR5-creating-an-ehr/" class="md-nav__link">
        Creating a new patient 'EHR'
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../opencdr/OCDR6-retrieving-an-ehrid/" class="md-nav__link">
        Retrieving the patient's ehrId
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Better Ehrscape API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Better Ehrscape API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ehrscape/ECDR1-authentication/" class="md-nav__link">
        Getting started - Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ehrscape/ECDR2-openehr-templates/" class="md-nav__link">
        Working with openEHR Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ehrscape/ECDR3-committing-a-composition/" class="md-nav__link">
        Committing openEHR data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ehrscape/ECDR4-retrieving-a-composition/" class="md-nav__link">
        Retrieving an openEHR Composition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ehrscape/ECDR5-retrieving-an-ehrId/" class="md-nav__link">
        Retrieving the patient's ehrId
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ehrscape/ECDR6-updating-a-composition/" class="md-nav__link">
        Updating an openEHR Composition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="querying-for-patient-allergies">Querying for patient allergies</h1>
<p>This section will take you through how to query for Current allergies held on the CDR, using AQL (Archetype Query Language)</p>
<p>The initial proposed dataset is
- the allergy name (code if available) 
- date of onset
- manifestation (the type of Reaction -rash, nausea etc)
- </p>
<div class="admonition important">
<p class="admonition-title">Exact query dataset to be finalised</p>
<p>The exact dataset and/or queryString may change pending discussion with clinicians but the principles will remain identical</p>
</div>
<h3 id="querying-an-openehr-cdr-archetype-query-language-aql">Querying an openEHR CDR - Archetype Query language (AQL)</h3>
<p>A CDR can be best thought of in terms of a exposing a complex object tree with the <code>EHR</code> object at the top, <code>Compositions</code> objects handling commits, but where <strong>all</strong> of the information in the tree can be traversed and accessed. Conceptually this is a logical query/graph language like SPARQL, the key difference being that the exact paths to the objects you might need to access are defined in the archetypes and templates you use to define and validate the data.</p>
<p>AQL can be written by hand but is normally done using a tool like the Better Studio </p>
<p>Understanding AQL is not generally important for third-party developers. Normally the correct AQL will be supplied by the CDR owner, indeed in production it is much more likely that server-side stored queries would be used.</p>
<h3 id="post-query-run-an-ad-hoc-aql-query"><code>POST /query</code> | Run an ad-hoc AQL query</h3>
<p>This example will retrieve the data requirement above. To run the query - a <code>querystring</code> needs to be carried in the <code>body</code> of the POST call as raw data with the Header <code>Content-Type</code> set to `application/json'</p>
<p>This is the <code>queryString:</code> that we need to send.</p>
<div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="o">/</span><span class="n">uid</span><span class="o">/</span><span class="n">value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">compositionId</span><span class="p">,</span>
<span class="w">        </span><span class="n">j</span><span class="o">/</span><span class="k">data</span><span class="p">[</span><span class="n">at0001</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0002</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="o">/</span><span class="n">value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">allergy_name</span><span class="p">,</span>
<span class="w">        </span><span class="n">j</span><span class="o">/</span><span class="k">data</span><span class="p">[</span><span class="n">at0001</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0002</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="o">/</span><span class="n">defining_code</span><span class="o">/</span><span class="n">code_string</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">allergy_code</span><span class="p">,</span>
<span class="w">        </span><span class="n">j</span><span class="o">/</span><span class="k">data</span><span class="p">[</span><span class="n">at0001</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0002</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="o">/</span><span class="n">defining_code</span><span class="o">/</span><span class="n">terminology_id</span><span class="o">/</span><span class="n">value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">allergy_terminology</span><span class="p">,</span>
<span class="w">       </span><span class="n">j</span><span class="o">/</span><span class="k">data</span><span class="p">[</span><span class="n">at0001</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0009</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0011</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">manifestation</span><span class="p">,</span>
<span class="w">       </span><span class="n">j</span><span class="o">/</span><span class="k">data</span><span class="p">[</span><span class="n">at0001</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0009</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0027</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">onset</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">EHR</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">[</span><span class="n">ehr_id</span><span class="o">/</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;{{ ehrId }}&#39;</span><span class="p">]</span>
<span class="k">CONTAINS</span><span class="w"> </span><span class="n">COMPOSITION</span><span class="w"> </span><span class="k">c</span>
<span class="k">CONTAINS</span><span class="w"> </span><span class="n">EVALUATION</span><span class="w"> </span><span class="n">j</span><span class="p">[</span><span class="n">openEHR</span><span class="o">-</span><span class="n">EHR</span><span class="o">-</span><span class="n">EVALUATION</span><span class="p">.</span><span class="n">adverse_reaction_risk</span><span class="p">.</span><span class="n">v1</span><span class="p">]</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">j</span><span class="o">/</span><span class="k">data</span><span class="p">[</span><span class="n">at0001</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0009</span><span class="p">]</span><span class="o">/</span><span class="n">items</span><span class="p">[</span><span class="n">at0027</span><span class="p">]</span><span class="o">/</span><span class="n">value</span><span class="w"> </span><span class="k">DESC</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Note the ehrId substitution</p>
</div>
<p>You will need to make sure that the <code>ehrId</code> variable in the queryString is substituted with the correct <code>ehrId</code> for the patient concerned.</p>
<p>Don't worry about this seemingly odd format -it is essentially a mix of SQL and a path-based syntax, like SPARQL or XQuery.</p>
<p>Running the query is easy- just call the <code>POST /query</code> call, sending the AQL string in the body of the request but <strong>note that you should strip the string of any linefeed and carriage returns</strong> etc. </p>
<p>The Postman 'Ad-hoc query' request has a utility function under 'Pre-req' that sanitises the string and sets it into an environment variable before inserting it into the request body.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Postman</label><label for="__tabbed_1_2">cURL</label><label for="__tabbed_1_3">NodeJs - Axios</label><label for="__tabbed_1_4">Python/requests</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><img alt="" src="../../images/cdr-run-query-postman.png" /></p>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>curl --location --request POST &#39;https://rest.ehrscape.com/rest/openehr/v1/query&#39; \
    --header &#39;Content-Type: application/json&#39; \
    --header &#39;Authorization: Basic YTgxZjQ3YzYtYTc1Ny00ZTM0LWI2NDQtM2NjYzYyYjRhMDFjOiQyYSQxMCQ2MTlraQ== \
    --data-raw &#39;{
        &quot;q&quot;: &quot;{{ queryString }}&quot;
    }&#39;
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;axios&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s2">&quot;q&quot;</span><span class="o">:</span><span class="s2">&quot;{{ queryString }}&quot;</span><span class="p">});</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;post&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;https://rest.ehrscape.com/rest/openehr/v1/query&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="s1">&#39;Authorization&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Basic YTgxZjQ3YzYtYTc1Ny00ZTM0LWI2NDQtM2NjYzYyYjRhMDFjOiQyYSQxMCQ2MTlraQ==&#39;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">data</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">data</span>
<span class="w">     </span><span class="p">};</span>

<span class="w">    </span><span class="nx">axios</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://https://rest.ehrscape.com/rest/openehr/v1/query&quot;</span>

<span class="n">payload</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">    </span><span class="se">\&quot;</span><span class="s2">q</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">{{ queryString }}</span><span class="se">\&quot;\n</span><span class="s2">}&quot;</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
<span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Basic YTgxZjQ3YzYtYTc1Ny00ZTM0LWI2NDQtM2NjYzYyYjRhMDFjOiQyYSQxMCQ2MTlraQ==&#39;</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">payload</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
</code></pre></div>
</div>
</div>
</div>
<h4 id="response">Response</h4>
<p>The AQL response comes as back as an openEHR <code>resultSet</code>, which is a tabular shape, the exact format being determined by the AQL itself.</p>
<p>In this example we have asked for scalar values only, but it is possible for AQL to return objects.</p>
<p>The <code>columns</code> object shows the openEHR paths and aliases that are are returned in each row. </p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;meta&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RESULTSET&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_created&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2020-10-18T15:28:31.403Z&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;_executed_aql&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT c/uid/value as compositionId,j/data[at0001]/items[at0002]/value/value as allergy_name,\nj/data[at0001]/items[at0002]/value/defining_code/code_string as allergy_code,\nj/data[at0001]/items[at0002]/value/defining_code/terminology_id/value as allergy_terminology,\n       j/data[at0001]/items[at0009]/items[at0011]/value as manifestation,\n       j/data[at0001]/items[at0009]/items[at0027]/value as onset\nFROM EHR e \nCONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.encounter.v1]\nCONTAINS EVALUATION j[openEHR-EHR-EVALUATION.adverse_reaction_risk.v1] \nORDER BY j/data[at0001]/items[at0009]/items[at0027]/value DESC&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;q&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT c/uid/value as compositionId,j/data[at0001]/items[at0002]/value/value as allergy_name,\nj/data[at0001]/items[at0002]/value/defining_code/code_string as allergy_code,\nj/data[at0001]/items[at0002]/value/defining_code/terminology_id/value as allergy_terminology,\n       j/data[at0001]/items[at0009]/items[at0011]/value as manifestation,\n       j/data[at0001]/items[at0009]/items[at0027]/value as onset\nFROM EHR e \nCONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.encounter.v1]\nCONTAINS EVALUATION j[openEHR-EHR-EVALUATION.adverse_reaction_risk.v1] \nORDER BY j/data[at0001]/items[at0009]/items[at0027]/value DESC&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;compositionId&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/uid/value&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;allergy_name&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/data[at0001]/items[at0002]/value/value&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;allergy_code&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/data[at0001]/items[at0002]/value/defining_code/code_string&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;allergy_terminology&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/data[at0001]/items[at0002]/value/defining_code/terminology_id/value&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manifestation&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/data[at0001]/items[at0009]/items[at0011]/value&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;onset&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/data[at0001]/items[at0009]/items[at0027]/value&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;rows&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;b960a98f-f799-4f98-b8f1-a3e86e33035e::4cce5a07-be4d-4318-a94f-3b8401853a20::1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;Peniccilin&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;371c5ff7-5078-4c17-b426-92e7351028d0::4cce5a07-be4d-4318-a94f-3b8401853a20::1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;Tetracycline&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;371c5ff7-5078-4c17-b426-92e7351028d0::4cce5a07-be4d-4318-a94f-3b8401853a20::1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s2">&quot;Erythromicin&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span><span class="p">,</span>
<span class="w">            </span><span class="kc">null</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.407015b8.min.js"></script>
      
    
  </body>
</html>